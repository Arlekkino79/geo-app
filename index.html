<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geolocalizzazione e invio dati</title>
</head>
<body>
  <h1>Invia la tua posizione</h1>
  <button id="btnGeo">Invia posizione</button>
  <p id="status"></p>

  <script>
    const statusEl = document.getElementById('status');
    const btnGeo = document.getElementById('btnGeo');

    btnGeo.addEventListener('click', () => {
      statusEl.textContent = 'Ottenendo posizione…';

      if (!navigator.geolocation) {
        statusEl.textContent = 'Geolocalizzazione non supportata dal browser.';
        return;
      }

      navigator.geolocation.getCurrentPosition(success, error);

      function success(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        statusEl.textContent = `Posizione ottenuta: lat=${lat.toFixed(5)}, lng=${lng.toFixed(5)}. Inviando…`;

        // Sostituisci con l'URL del tuo deployment Google Apps Script
        const url = "https://script.google.com/macros/s/TUO_DEPLOYMENT_ID/exec";

        fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ lat: lat, lng: lng }),
        })
          .then((res) => res.text())
          .then((text) => {
            if (text === "OK") {
              statusEl.textContent = 'Dati inviati correttamente!';
            } else {
              statusEl.textContent = 'Risposta inattesa dal server: ' + text;
            }
          })
          .catch((err) => {
            console.error(err);
            statusEl.textContent = 'Errore nell\'invio dei dati.';
          });
      }

      function error() {
        statusEl.textContent = 'Impossibile ottenere la posizione.';
      }
    });
  </script>
</body>
</html>
